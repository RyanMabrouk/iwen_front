{"version":3,"file":"static/chunks/app/(auth)/forget_password/token/page-6c78be8bb2216440.js","mappings":"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","sources":["webpack://_N_E/?b6f5","webpack://_N_E/./src/hooks/auth/useSendOTP.ts","webpack://_N_E/./src/hooks/auth/useVerifyOTP.ts","webpack://_N_E/./src/app/(auth)/forget_password/token/ui/Token.tsx","webpack://_N_E/./src/app/(auth)/forget_password/token/page.tsx"],"sourcesContent":["import(/* webpackMode: \"eager\" */ \"/Users/macmini/Sites/iwan/iwen_front/src/app/(auth)/forget_password/token/page.tsx\");\n","import { useMutation } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/useToast\";\nimport handleForgetPassword from \"@/app/(auth)/handlers/auth/handleForgetPassword\";\n\nexport default function useSendOTP(email: string) {\n  const { toast } = useToast();\n\n  return useMutation({\n    mutationFn: async () => handleForgetPassword(email ?? \"\"),\n    onSuccess: () => {\n      toast.success(\"(OTP) تمت إعادة إرسال كلمة المرور لمرة واحدة بنجاح\");\n    },\n    onError: (error) => {\n      try {\n        const errorMessages = JSON.parse(error.message);\n        if (Array.isArray(errorMessages)) {\n          errorMessages.forEach((errorObj) => {\n            if (\n              errorObj &&\n              typeof errorObj === \"object\" &&\n              \"message\" in errorObj\n            ) {\n              toast.error(errorObj.message);\n            }\n          });\n        } else {\n          // If it's not an array, just show the error message\n          toast.error(error.message);\n        }\n      } catch (e) {\n        // If parsing fails, show the original error message\n        toast.error(error.message);\n      }\n    },\n  });\n}\n","import verifyOTP from \"@/actions/auth/verifyOTP\";\nimport { useToast } from \"@/hooks/useToast\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { useRouter } from \"next/navigation\";\n\nexport default function useVerifyOTP(email: string, otp: string) {\n  const { toast } = useToast();\n  const router = useRouter();\n  return useMutation({\n    mutationFn: async () => verifyOTP(email ?? \"\", otp),\n    onSuccess: () => {\n      toast.success(\"تم التحقق من الرمز المميز بنجاح\");\n      router.push(`/change_password`);\n    },\n    onError: (error) => {\n      try {\n        const errorMessages = JSON.parse(error.message);\n        if (Array.isArray(errorMessages)) {\n          errorMessages.forEach((errorObj) => {\n            if (\n              errorObj &&\n              typeof errorObj === \"object\" &&\n              \"message\" in errorObj\n            ) {\n              toast.error(errorObj.message);\n            }\n          });\n        } else {\n          // If it's not an array, just show the error message\n          toast.error(error.message);\n        }\n      } catch (e) {\n        // If parsing fails, show the original error message\n        toast.error(error.message);\n      }\n    },\n  });\n}\n","\"use client\";\n\nimport React, { useState, useRef, useEffect } from \"react\";\nimport { useSearchParams } from \"next/navigation\";\nimport useSendOTP from \"../../../../../hooks/auth/useSendOTP\";\nimport useVerifyOTP from \"../../../../../hooks/auth/useVerifyOTP\";\nimport { useCounter } from \"@/provider/auth/CounterProvider\";\nexport default function Token() {\n  const [verificationCode, setVerificationCode] = useState([\"\", \"\", \"\", \"\", \"\", \"\"]);\n  const {\n    counter: cooldown,\n    setCounter: setCooldown\n  } = useCounter();\n  const searchParams = useSearchParams();\n  const email = searchParams.get(\"email\") ?? \"\";\n  const {\n    mutate: send\n  } = useSendOTP(email);\n  const {\n    mutate\n  } = useVerifyOTP(email, verificationCode.join(\"\"));\n  useEffect(() => {\n    if (verificationCode.join(\"\").length === 6) {\n      mutate();\n    }\n  }, [verificationCode, mutate]);\n  const verificationInputRefs = [useRef<HTMLInputElement>(null), useRef<HTMLInputElement>(null), useRef<HTMLInputElement>(null), useRef<HTMLInputElement>(null), useRef<HTMLInputElement>(null), useRef<HTMLInputElement>(null)];\n  const handleVerificationInputChange = (index: number, value: string) => {\n    if (/^[0-9]?$/.test(value)) {\n      const newCode = [...verificationCode];\n      newCode[index] = value;\n      setVerificationCode(newCode);\n      if (value && index < 5) {\n        verificationInputRefs[index + 1].current?.focus();\n      }\n    }\n  };\n  const handleVerificationInputKeyDown = (index: number, e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === \"Backspace\") {\n      if (!verificationCode[index] && index > 0) {\n        verificationInputRefs[index - 1].current?.focus();\n      }\n    } else if (e.key === \"ArrowLeft\" && index > 0) {\n      e.preventDefault();\n      verificationInputRefs[index - 1].current?.focus();\n    } else if (e.key === \"ArrowRight\" && index < 5) {\n      e.preventDefault();\n      verificationInputRefs[index + 1].current?.focus();\n    }\n  };\n  const handlePaste = (e: React.ClipboardEvent<HTMLInputElement>) => {\n    e.preventDefault();\n    const pastedData = e.clipboardData.getData(\"text\");\n    const pastedOTP = pastedData.slice(0, 6).replace(/\\D/g, \"\");\n    if (pastedOTP.length === 6) {\n      const newCode = pastedOTP.split(\"\").map(char => char || \"\");\n      setVerificationCode(newCode);\n      verificationInputRefs[5].current?.focus();\n    }\n  };\n  const handleResendOTP = () => {\n    if (cooldown === 0) {\n      send();\n      const newCooldown = 60;\n      setCooldown(newCooldown);\n      localStorage.setItem(\"otpCooldownEnd\", (Date.now() + newCooldown * 1000).toString());\n    }\n  };\n  return <div className=\"flex flex-col items-end gap-3 max-md:gap-5 max-md:p-3\" data-sentry-component=\"Token\" data-sentry-source-file=\"Token.tsx\">\n      <h1 className=\"text-xl font-semibold max-md:text-base\">\n        نسخ رمز التحقق للمواصلة\n      </h1>\n      <h1 className=\"text-right text-xl max-md:text-base\">\n        : أدخل العدد المكون من 6 أرقام الذي أرسلناه إلى عنوان بريدك الإلكتروني\n      </h1>\n      <div className=\"flex w-full items-center justify-end gap-2 max-md:justify-between max-md:gap-1\">\n        {verificationCode.map((digit, index) => <React.Fragment key={index}>\n            {index > 0 && <span className=\"text-xl max-md:hidden\">-</span>}\n            <input ref={verificationInputRefs[index]} value={digit} onChange={e => handleVerificationInputChange(index, e.target.value)} onKeyDown={e => handleVerificationInputKeyDown(index, e)} onPaste={handlePaste} maxLength={1} placeholder=\"-\" type=\"text\" inputMode=\"numeric\" pattern=\"[0-9]*\" className={`h-[5rem] w-[4rem] rounded-xl border text-center text-2xl text-teal-600 outline-none max-xl:h-[4rem] max-xl:w-[3rem] max-lg:h-[3rem] max-lg:w-[35px] ${digit ? \"border-teal-600\" : \"border-gray-300\"}`} />\n          </React.Fragment>)}\n      </div>\n      <p className=\"flex items-center gap-2 max-md:mt-10\">\n        <button onClick={handleResendOTP} disabled={cooldown > 0} className={`cursor-pointer text-nowrap text-xl font-semibold max-lg:text-base ${cooldown > 0 ? \"cursor-not-allowed opacity-50\" : \"\"}`}>\n          {cooldown > 0 ? `إعادة الإرسال (${cooldown})` : \"إعادة الإرسال الآن\"}\n        </button>\n        <span className=\"text-nowrap\">لم تتلق الرمز ؟</span>\n      </p>\n    </div>;\n}","\"use client\";\n\nimport React, { Suspense } from \"react\";\nimport Token from \"./ui/Token\";\nimport { Player } from \"@lottiefiles/react-lottie-player\";\nexport default function page() {\n  return <Suspense fallback={<Player className=\"m-auto\" autoplay loop src=\"/loading.json\" style={{\n    height: \"12rem\",\n    width: \"12rem\"\n  }} />} data-sentry-element=\"Suspense\" data-sentry-component=\"page\" data-sentry-source-file=\"page.tsx\">\n      <Token data-sentry-element=\"Token\" data-sentry-source-file=\"page.tsx\" />\n    </Suspense>;\n}"],"names":["Promise","resolve","then","__webpack_require__","bind","Token","searchParams","verificationCode","setVerificationCode","useState","counter","cooldown","setCounter","setCooldown","useCounter","email","useSearchParams","get","mutate","send","useSendOTP","toast","useToast","useMutation","mutationFn","handleForgetPassword","onSuccess","success","onError","errorMessages","JSON","parse","error","message","Array","isArray","forEach","errorObj","e","useVerifyOTP","otp","router","useRouter","verifyOTP","push","join","useEffect","length","verificationInputRefs","useRef","handleVerificationInputChange","index","value","test","newCode","current","focus","handleVerificationInputKeyDown","key","preventDefault","handlePaste","pastedOTP","pastedData","clipboardData","getData","slice","replace","split","map","char","jsx_runtime","jsxs","div","className","data-sentry-component","data-sentry-source-file","jsx","h1","digit","React","span","input","ref","onChange","target","onKeyDown","onPaste","maxLength","placeholder","type","inputMode","pattern","concat","p","button","onClick","localStorage","setItem","Date","now","newCooldown","toString","disabled","page","Suspense","fallback","Player","autoplay","loop","src","style","height","width","data-sentry-element"],"sourceRoot":""}