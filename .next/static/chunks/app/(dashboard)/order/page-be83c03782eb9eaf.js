!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="ea21cd37-3173-4261-9886-e93611dcecf6",e._sentryDebugIdIdentifier="sentry-dbid-ea21cd37-3173-4261-9886-e93611dcecf6")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4103],{55296:function(e,t,a){Promise.resolve().then(a.bind(a,63250))},10374:function(e,t,a){"use strict";var r=a(27011);a.o(r,"redirect")&&a.d(t,{redirect:function(){return r.redirect}}),a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},63250:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Z}});var r=a(66281),l=a(69278),s=a(47293),n=a(33202),i=a(22151),d=a(51956),o=a(13285),c=a(54548),u=a(68651),m=a(68756),f=a(47960),x=a(64502),h=a(91311),v=a(15177),p=a(50319),g=a(45516),y=a(3312),b=a(29146),j=a(10374),w=a(91609),N=a(9281);let _=v.z.string().regex(/^0\d{9}$/,"رقم الهاتف يجب أن يبدأ ب0 ويحتوي على 10 أرقام");function Z(){var e,t,a,Z,k,q,S,P,C,E;let{toast:I}=(0,g.useToast)(),[D,O]=(0,m.useState)(!1),{data:F,isLoading:Q}=(0,f.Z)(),z=(0,b.Z)(),[K,T]=(0,m.useState)(""),[V,R]=(0,m.useState)(""),[B,J]=(0,m.useState)("onDelivery"),[L,G]=(0,m.useState)();(0,m.useEffect)(()=>{var e;(null==F?void 0:null===(e=F.data)||void 0===e?void 0:e.state)&&T(F.data.state)},[null==F?void 0:null===(e=F.data)||void 0===e?void 0:e.state]),(0,m.useEffect)(()=>{var e;(null==F?void 0:null===(e=F.data)||void 0===e?void 0:e.city)&&R(F.data.city)},[null==F?void 0:null===(t=F.data)||void 0===t?void 0:t.city]);let H=(0,x.useMutation)({mutationFn:async e=>{var t,a,r,l;let s=String(e.get("phone_number")),n=String(e.get("first_name")),i=String(e.get("address1")),d=String(e.get("postalCode")),o=null!==(r=null===(t=z.data)||void 0===t?void 0:t.map(e=>({id:e.id,quantity:e.quantity})))&&void 0!==r?r:[],c={name:n,email:null==F?void 0:null===(a=F.data)||void 0===a?void 0:a.email,phone_number:s,address:i,city:V,postal_code:d,payment_method:B,books:o},u=(0,h.Z)({resource:"orders",action:"createOrder"});try{_.parse(s)}catch(e){if(e instanceof v.z.ZodError)throw Error(null===(l=e.errors[0])||void 0===l?void 0:l.message);throw Error("")}let{error:m,validationErrors:f}=await (0,p.Z)({method:"POST",url:u(),payload:c});if(m)throw G(f),Error("")},onSuccess:()=>{z.clearCart(),O(!0),I.success("تم تحديث الملف الشخصي بنجاح")},onError:e=>{I.error(e.message||"حدث خطأ أثناء معالجة الطلب")}});return(null==F?void 0:F.data)||Q||(0,j.redirect)("/login"),(0,r.jsx)("div",{dir:"rtl",className:"my-8 h-fit","data-sentry-component":"Page","data-sentry-source-file":"page.tsx",children:(0,r.jsxs)("div",{className:"relative mx-auto my-10 flex w-full flex-row items-start justify-center gap-4 bg-bgcolor1 py-4",children:[(0,r.jsx)("div",{className:"flex h-full items-center justify-center",children:D?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,r.jsx)(l.default,{src:"/success_order.svg",height:300,width:300,alt:"",className:"-mt-4 mb-6 h-full w-full max-w-[60svw] object-cover"}),(0,r.jsx)(N.default,{href:"/purchaseHistory",children:(0,r.jsxs)(w.default,{size:"md",className:"flex w-[10rem] flex-row-reverse items-center justify-center gap-1",children:[(0,r.jsx)(l.default,{src:"/double-arrow-right-white.svg",alt:"",className:"-ml-3 rotate-180",width:25,height:25}),(0,r.jsx)("span",{children:"طلباتي"})]})})]}):(0,r.jsxs)("form",{dir:"rtl",className:"min-w-[60svw] rounded-md bg-white p-6 shadow-md",onSubmit:e=>{e.preventDefault();let t=new FormData(e.currentTarget);H.mutate(t)},children:[(0,r.jsx)("div",{className:"mb-6 text-lg font-semibold",children:"الشحن"}),(0,r.jsxs)("div",{className:"grid w-full grid-cols-2 gap-6 md:grid-cols-2",children:[(0,r.jsx)(s.Z,{errors:null==L?void 0:L.name,label:"الإسم",name:"first_name",placeholder:"صدقي",defaultValue:null==F?void 0:null===(a=F.data)||void 0===a?void 0:a.first_name,required:!0,icon:(0,r.jsx)(i.Z,{className:"h-4 w-4"})}),(0,r.jsx)(s.Z,{errors:null==L?void 0:L.email,label:"البريد الإلكتروني",name:"email",type:"email",placeholder:"sedki_tilja@gmail.com",defaultValue:null==F?void 0:null===(Z=F.data)||void 0===Z?void 0:Z.email,required:!0,disabled:!0,icon:(0,r.jsx)(d.Z,{className:"h-4 w-4"})}),(0,r.jsx)(n.Z,{label:"الولاية",name:"state",placeholder:"اختر الولاية",options:y.a.map(e=>e.state),value:K,required:!0,onChange:e=>{e&&T(e)}}),(0,r.jsx)(n.Z,{errors:null==L?void 0:L.city,label:"المدينة",name:"city",placeholder:"اختر المدينة",options:(null===(k=y.a.find(e=>e.state===K))||void 0===k?void 0:k.cities)||[],value:V,required:!0,onChange:e=>{e&&R(e)},disabled:!K})," ",(0,r.jsx)(s.Z,{errors:null==L?void 0:L.phone_number,label:"رقم الهاتف",name:"phone_number",type:"number",placeholder:"004 47 18 74",defaultValue:null==F?void 0:null===(q=F.data)||void 0===q?void 0:q.phone_number,required:!0,icon:(0,r.jsx)(o.Z,{className:"h-4 w-4"})}),(0,r.jsx)(s.Z,{errors:null==L?void 0:L.postal_code,label:"الرقم البريدي",name:"postalCode",placeholder:"10004",defaultValue:null==F?void 0:null===(S=F.data)||void 0===S?void 0:S.postal_code,required:!0,icon:(0,r.jsx)(c.Z,{className:"h-4 w-4"})}),(0,r.jsx)(s.Z,{errors:null==L?void 0:L.address,label:"عنوان السكن - 1",name:"address1",placeholder:"شارع المهدي بن سلامة",defaultValue:null==F?void 0:null===(P=F.data)||void 0===P?void 0:P.street,required:!0,icon:(0,r.jsx)(u.Z,{className:"h-4 w-4"})})]}),(0,r.jsx)("div",{className:"my-12 text-lg font-semibold",children:"طريقة الدفع"}),(0,r.jsx)("div",{className:"my-12 flex flex-row items-center gap-4",children:[{img:"/truck.svg",value:"onDelivery",text:"الدفع عند التسليم"},{img:"/bank.svg",value:"bank",text:"الدفع عن طريق البنك",forbidden:!0},{img:"/card.svg",value:"online",text:"الدفع عن طريق البطاقة البنكية",forbidden:!0}].map((e,t)=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{type:"radio",name:"payment_method",id:"payment_method_".concat(t),value:e.value,onChange:t=>{e.forbidden||J(t.target.value)},className:"hidden"}),(0,r.jsxs)("label",{htmlFor:"payment_method_".concat(t),className:"relative flex h-32 w-52 flex-col items-center justify-end gap-2 rounded-md border py-3 transition-all ease-linear ".concat(B===e.value?"border-2 border-color1":"border-gray-200"," ").concat(e.forbidden?"cursor-not-allowed":"hover:cursor-pointer"),children:[(0,r.jsx)("span",{className:"absolute right-2 top-2 size-4 rounded-full bg-color1 ".concat(e.forbidden?"hidden":"block")}),(0,r.jsx)(l.default,{src:e.img,alt:"",width:110,height:110,className:"bg rounded-md bg-white px-6"}),(0,r.jsx)("hr",{className:"w-[75%] ".concat(B===e.value?"h-[3px] bg-color1":"h-[1px] bg-gray-200")}),(0,r.jsx)("span",{className:"text-sm transition-all ease-linear ".concat(B===e.value?"font-semibold opacity-100":"text-black opacity-50"),children:e.text})]},t)]}))}),(0,r.jsx)("div",{className:"mt-12 text-lg font-semibold",children:"تأكيد الشراء"}),(0,r.jsx)("div",{className:"flex max-w-[60svw] flex-1 flex-row flex-wrap gap-4",children:null===(C=z.data)||void 0===C?void 0:C.map((e,t)=>{var a,s;return(0,r.jsxs)("div",{className:"flex max-w-[40%] flex-row items-start gap-3 rounded-md bg-color7 px-3 py-2",children:[(0,r.jsx)(l.default,{src:null!==(s=null===(a=e.images_urls)||void 0===a?void 0:a[0])&&void 0!==s?s:"/empty-book.svg",alt:"book",className:"rounded-md bg-white px-6 py-4",width:100,height:100}),(0,r.jsxs)("div",{className:"mt-6 flex flex-col items-start justify-start gap-2",children:[(0,r.jsxs)("div",{className:"flex flex-col gap-2 text-sm font-medium",children:[(0,r.jsxs)("span",{className:"flex flex-row items-start justify-start gap-1",children:[(0,r.jsx)("span",{"data-tip":e.title,className:"tooltip tooltip-top z-[40] line-clamp-1 text-right",children:e.title}),(0,r.jsxs)("span",{children:["(",e.quantity,"x)"]})]}),(0,r.jsxs)("span",{className:"text-lg font-medium",children:[e.price_after_discount," د.م"]})]}),e.isbn&&(0,r.jsxs)("span",{className:"flex flex-row items-start justify-start gap-2 text-sm text-color4",children:[(0,r.jsx)("p",{children:"رقم الكتاب :"}),(0,r.jsx)("p",{children:e.isbn})]})]})]},e.id)})}),(0,r.jsxs)("div",{className:"my-8 flex flex-row items-center gap-6",children:[(0,r.jsxs)("div",{className:"flex w-full flex-row items-center justify-between rounded-md bg-color7 px-12 py-6 text-center text-lg text-black",children:[(0,r.jsx)("span",{className:"text-lg",children:"توصيل"}),(0,r.jsxs)("span",{children:[8," د.م"]})]}),(0,r.jsxs)("div",{className:"flex w-full flex-row items-center justify-between rounded-md bg-color7 px-12 py-6 text-center text-lg text-black",children:[(0,r.jsx)("span",{className:"text-lg",children:"الإجمالي الفرعي"}),(0,r.jsxs)("del",{children:[z.total_before_discount," د.م"]})]}),(0,r.jsxs)("div",{className:"flex w-full flex-row items-center justify-between rounded-md bg-color7 px-12 py-6 text-center text-lg font-semibold text-color1",children:[(0,r.jsx)("span",{className:"text-lg",children:"المبلغ النهائي"}),(0,r.jsxs)("span",{children:[(null!==(E=z.total)&&void 0!==E?E:0)+8," د.م"]})]})]}),(0,r.jsxs)("div",{className:"flex flex-row justify-between pl-6",children:[(0,r.jsxs)("span",{className:"flex flex-row items-center gap-2",children:[(0,r.jsx)(l.default,{src:"/truck.svg",alt:"",width:60,height:60,className:"bg rounded-md bg-white"}),(0,r.jsx)("span",{className:"text-lg font-semibold",children:"الدفع نقدا عند التوصيل"})]}),(0,r.jsx)("button",{type:"submit",disabled:H.isPending,className:"rounded-md bg-color2 p-2 px-4 text-lg text-white opacity-100 hover:opacity-50",children:H.isPending?"جاري الطلب...":"تأكيد الطلب"})]})]})}),(0,r.jsxs)("div",{className:"-ml-14 flex flex-col gap-2",children:[(0,r.jsx)(l.default,{src:"/dar_iwan.svg",alt:"book",className:"-mt-4 rounded-lg",width:300,height:300,"data-sentry-element":"Image","data-sentry-source-file":"page.tsx"}),(0,r.jsx)(l.default,{src:"/phone_number.svg",alt:"book",className:"-mt-4 rounded-lg",width:300,height:300,"data-sentry-element":"Image","data-sentry-source-file":"page.tsx"})]})]})})}},91609:function(e,t,a){"use strict";a.d(t,{default:function(){return s}});var r=a(66281),l=a(33031);function s(e){let{className:t="",size:a="md",children:s,onClick:n,variant:i="primary"}=e;return(0,r.jsx)("button",{className:(0,l.cn)("rounded-lg px-[16px] text-center font-medium transition-all hover:brightness-110","whitespace-nowrap","primary"===i?"bg-primary-400 text-white":"border border-primary-400 bg-white text-primary-400",{sm:"h-[2.25rem] text-base",md:"h-[3rem] text-lg",lg:"h-[3.5rem] text-xl"}[a],t),onClick:n,"data-sentry-component":"PrimaryButton","data-sentry-source-file":"PrimaryButton.tsx",children:s})}a(68756)},835:function(e,t,a){"use strict";function r(e){let{currentPathname:t,values:a}=e,r=new URLSearchParams;return a.forEach(e=>{let{name:t,value:a}=e;r.set(t,a)}),t+"?"+r.toString()}a.d(t,{Z:function(){return r}})},24680:function(e,t,a){"use strict";function r(e){let t=null;try{t=localStorage.getItem(e)}catch(e){}return t?JSON.parse(t):null}a.d(t,{Z:function(){return r}})},29146:function(e,t,a){"use strict";a.d(t,{Z:function(){return o}});var r=a(797),l=a(89691),s=a(24680),n=a(59100);let i=()=>({queryKey:["cart"],queryFn:async()=>{var e;let t=(0,s.Z)("cart");if(!t)return[];let{data:a}=await (0,n.y)({limit:t.length,filters:{"books.id":[{operator:"in",value:t.map(e=>e.id)}]}});return null!==(e=null==a?void 0:a.data.map(e=>{var a,r;return{...e,quantity:null!==(r=null===(a=t.find(t=>t.id===e.id))||void 0===a?void 0:a.quantity)&&void 0!==r?r:0}}))&&void 0!==e?e:[]}});function d(e,t){try{let a=JSON.stringify(t);localStorage.setItem(e,a)}catch(e){}}function o(){var e,t;let a=(0,r.useQuery)(i()),n=null===(e=a.data)||void 0===e?void 0:e.reduce((e,t)=>e+t.price_after_discount,0),o=null===(t=a.data)||void 0===t?void 0:t.reduce((e,t)=>e+t.price,0),c=(0,l.useQueryClient)();return{...a,cart:a.data,total:n,total_before_discount:o,addToCart:e=>{(function(e){var t;let a=null!==(t=(0,s.Z)("cart"))&&void 0!==t?t:[],r=a.find(t=>t.id===e.id);r?r.quantity+=1:a.push({...e,quantity:1}),d("cart",a)})(e),c.invalidateQueries({queryKey:["cart"]})},removeFromCart:e=>{var t;d("cart",(null!==(t=(0,s.Z)("cart"))&&void 0!==t?t:[]).reduce((t,a)=>(a.id===e?a.quantity>1&&t.push({...a,quantity:a.quantity-1}):t.push(a),t),[])),c.invalidateQueries({queryKey:["cart"]})},clearCart:()=>{d("cart",[]),c.invalidateQueries({queryKey:["cart"]})}}}},59100:function(e,t,a){"use strict";a.d(t,{Q:function(){return n},y:function(){return i}});var r=a(835),l=a(50319),s=a(91311);let n=e=>({queryKey:["books",e],queryFn:async()=>{let{data:t,error:a}=await i(e);return a?{data:null,error:a}:{data:t,error:null}}});async function i(e){let t=(0,s.Z)({resource:"books",action:"getBooks"}),a=Object.keys(e).map(t=>({name:t,value:JSON.stringify(e[t])})),n=(0,r.Z)({currentPathname:t(),values:a});return await (0,l.Z)({method:"GET",url:n})}}},function(e){e.O(0,[7182,9278,797,9281,3435,1711,1186,5657,8647,4913,364,5768,1744],function(){return e(e.s=55296)}),_N_E=e.O()}]);